!function(e,r){"use strict";function t(e,r){if(u(e)){r=r||[];for(var t=0,n=e.length;t<n;t++)r[t]=e[t]}else if(s(e)){r=r||{};for(var a in e)"$"===a.charAt(0)&&"$"===a.charAt(1)||(r[a]=e[a])}return r||e}function n(){function e(e,t){return r.extend(Object.create(e),t)}function n(e,r){var t=r.caseInsensitiveMatch,n={originalPath:e,regexp:e},a=n.keys=[];return e=e.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)(\*\?|[?*])?/g,function(e,r,t,n){var i="?"===n||"*?"===n?"?":null,o="*"===n||"*?"===n?"*":null;return a.push({name:t,optional:!!i}),r=r||"",(i?"":r)+"(?:"+(i?r:"")+(o&&"(.+?)"||"([^/]+)")+(i||"")+")"+(i||"")}).replace(/([\/$*])/g,"\\$1"),n.regexp=new RegExp("^"+e+"$",t?"i":""),n}u=r.isArray,s=r.isObject,l=r.isDefined,f=r.noop;var a={};this.when=function(e,i){var o=t(i);if(r.isUndefined(o.reloadOnSearch)&&(o.reloadOnSearch=!0),r.isUndefined(o.caseInsensitiveMatch)&&(o.caseInsensitiveMatch=this.caseInsensitiveMatch),a[e]=r.extend(o,e&&n(e,o)),e){var c="/"===e[e.length-1]?e.substr(0,e.length-1):e+"/";a[c]=r.extend({redirectTo:e},n(c,o))}return this},this.caseInsensitiveMatch=!1,this.otherwise=function(e){return"string"==typeof e&&(e={redirectTo:e}),this.when(null,e),this},h=!0,this.eagerInstantiationEnabled=function(e){return l(e)?(h=e,this):h},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$templateRequest","$sce","$browser",function(t,n,i,o,c,u,s,l){function h(e,r){var t=r.keys,n={};if(!r.regexp)return null;var a=r.regexp.exec(e);if(!a)return null;for(var i=1,o=a.length;i<o;++i){var c=t[i-1],u=a[i];c&&u&&(n[c.name]=u)}return n}function $(e){var n=S.current;R=C(),(x=R&&n&&R.$$route===n.$$route&&r.equals(R.pathParams,n.pathParams)&&!R.reloadOnSearch&&!D)||!n&&!R||t.$broadcast("$routeChangeStart",R,n).defaultPrevented&&e&&e.preventDefault()}function v(){var e=S.current,n=R;if(x)e.params=n.params,r.copy(e.params,i),t.$broadcast("$routeUpdate",e);else if(n||e){D=!1,S.current=n;var a=o.resolve(n);l.$$incOutstandingRequestCount(),a.then(p).then(m).then(function(o){return o&&a.then(g).then(function(a){n===S.current&&(n&&(n.locals=a,r.copy(n.params,i)),t.$broadcast("$routeChangeSuccess",n,e))})}).catch(function(r){n===S.current&&t.$broadcast("$routeChangeError",n,e,r)}).finally(function(){l.$$completeOutstandingRequest(f)})}}function p(e){var t={route:e,hasRedirection:!1};if(e)if(e.redirectTo)if(r.isString(e.redirectTo))t.path=P(e.redirectTo,e.params),t.search=e.params,t.hasRedirection=!0;else{var a=n.path(),i=n.search(),u=e.redirectTo(e.pathParams,a,i);r.isDefined(u)&&(t.url=u,t.hasRedirection=!0)}else if(e.resolveRedirectTo)return o.resolve(c.invoke(e.resolveRedirectTo)).then(function(e){return r.isDefined(e)&&(t.url=e,t.hasRedirection=!0),t});return t}function m(e){var r=!0;if(e.route!==S.current)r=!1;else if(e.hasRedirection){var t=n.url(),a=e.url;a?n.url(a).replace():a=n.path(e.path).search(e.search).replace().url(),a!==t&&(r=!1)}return r}function g(e){if(e){var t=r.extend({},e.resolve);r.forEach(t,function(e,n){t[n]=r.isString(e)?c.get(e):c.invoke(e,null,null,n)});var n=w(e);return r.isDefined(n)&&(t.$template=n),o.all(t)}}function w(e){var t,n;return r.isDefined(t=e.template)?r.isFunction(t)&&(t=t(e.params)):r.isDefined(n=e.templateUrl)&&(r.isFunction(n)&&(n=n(e.params)),r.isDefined(n)&&(e.loadedTemplateUrl=s.valueOf(n),t=u(n))),t}function C(){var t,i;return r.forEach(a,function(a,o){!i&&(t=h(n.path(),a))&&(i=e(a,{params:r.extend({},n.search(),t),pathParams:t}),i.$$route=a)}),i||a[null]&&e(a[null],{params:{},pathParams:{}})}function P(e,t){var n=[];return r.forEach((e||"").split(":"),function(e,r){if(0===r)n.push(e);else{var a=e.match(/(\w+)(?:[?*])?(.*)/),i=a[1];n.push(t[i]),n.push(a[2]||""),delete t[i]}}),n.join("")}var R,x,D=!1,S={routes:a,reload:function(){D=!0;var e={defaultPrevented:!1,preventDefault:function(){this.defaultPrevented=!0,D=!1}};t.$evalAsync(function(){$(e),e.defaultPrevented||v()})},updateParams:function(e){if(!this.current||!this.current.$$route)throw d("norout","Tried updating route when with no current route");e=r.extend({},this.current.params,e),n.path(P(this.current.$$route.originalPath,e)),n.search(e)}};return t.$on("$locationChangeStart",$),t.$on("$locationChangeSuccess",v),S}]}function a(e){h&&e.get("$route")}function i(){this.$get=function(){return{}}}function o(e,t,n){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(a,i,o,c,u){function s(){$&&(n.cancel($),$=null),f&&(f.$destroy(),f=null),h&&($=n.leave(h),$.done(function(e){!1!==e&&($=null)}),h=null)}function l(){var o=e.current&&e.current.locals,c=o&&o.$template;if(r.isDefined(c)){var l=a.$new(),$=e.current,p=u(l,function(e){n.enter(e,null,h||i).done(function(e){!1===e||!r.isDefined(d)||d&&!a.$eval(d)||t()}),s()});h=p,f=$.scope=l,f.$emit("$viewContentLoaded"),f.$eval(v)}else s()}var f,h,$,d=o.autoscroll,v=o.onload||"";a.$on("$routeChangeSuccess",l),l()}}}function c(e,t,n,a,i){return{restrict:"ECA",priority:-400,link:function(o,c){var u=n.current,s=u.locals;c.html(s.$template);var l=e(c.contents());if(u.controller){s.$scope=o;var f=i.defer();f.promise.then(function(e){console.log(u),r.isDefined(u.$$route.on[e])&&a.url(u.$$route.on[e])}),s.$done=f.resolve;var h=t(u.controller,s);u.controllerAs&&(o[u.controllerAs]=h),c.data("$ngControllerController",h),c.children().data("$ngControllerController",h)}o[u.resolveAs||"$resolve"]=s,l(o)}}}var u,s,l,f,h,$=r.module("qRoute",[]).provider("$route",n).run(a),d=r.$$minErr("qRoute");a.$inject=["$injector"],$.provider("$routeParams",i),$.directive("ngView",o),$.directive("ngView",c),o.$inject=["$route","$anchorScroll","$animate"],c.$inject=["$compile","$controller","$route","$location","$q"]}(window,window.angular);
//# sourceMappingURL=angular-promise-router.min.js.map